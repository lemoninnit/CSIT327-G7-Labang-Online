{% load tz %}
{% load static %}
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Announcements - LabangOnline</title>
      <link rel="stylesheet" href="{% static 'css/app.css' %}" />
      <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
      <link rel="icon" href="{% static 'logo.png' %}" type="image/png" />
      <link rel="stylesheet" href="{% static 'css/pages/announcements.css' %}" />
      <!-- inline styles moved to static/css/pages/announcements.css -->
      <!--
        /* Topbar matches dashboard theme */
        .topbar {
          position: sticky;
          top: 0;
          z-index: 100;
          background: var(--panel);
          border-bottom: 1px solid var(--border);
        }

        /* Announcements layout */
        .announcements-container {
          padding: 30px 60px;
          width: 100%;
          max-width: none;
          margin: 0;
          flex: 1;
          overflow-y: auto;
        }

        /* Smooth scroll and scrollbar aligned to theme */
        .main-content { scroll-behavior: smooth; }
        .main-content::-webkit-scrollbar { width: 8px; }
        .main-content::-webkit-scrollbar-track { background: var(--bg); }
        .main-content::-webkit-scrollbar-thumb { background: var(--panel-hover); border-radius: 4px; }
        .main-content::-webkit-scrollbar-thumb:hover { background: var(--brand); }

        .page-header { margin-bottom: 30px; }
        .page-header h1 { font-size: 2rem; color: var(--text); margin-bottom: 10px; }
        .page-header p { color: var(--text-secondary); }

        /* Filter Section */
        .filter-section {
          background: var(--panel);
          padding: 20px;
          border-radius: 12px;
          margin-bottom: 20px;
          border: 1px solid var(--border);
        }
        .filter-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .filter-btn {
          padding: 8px 16px;
          border: 1px solid var(--border);
          background: transparent;
          border-radius: 20px;
          cursor: pointer;
          transition: all 0.3s;
          color: var(--text);
          font-size: 0.9rem;
        }
        .filter-btn:hover { border-color: var(--brand); color: var(--brand); }
        .filter-btn.active { background: var(--brand); border-color: var(--brand); color: #fff; }

        /* Announcement Cards */
        .announcements-grid { display: grid; gap: 20px; }
        .announcement-card {
          background: var(--panel);
          border-radius: 12px;
          padding: 24px;
          border: 1px solid var(--border);
          transition: transform 0.3s, box-shadow 0.3s;
          cursor: pointer;
          border-left: 4px solid var(--brand);
        }
        .announcement-card:hover { transform: translateY(-4px); }
        .announcement-card.event { border-left-color: var(--brand); }
        .announcement-card.alert { border-left-color: var(--text-secondary); }
        .announcement-card.maintenance { border-left-color: var(--text-secondary); }

        .announcement-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
        .announcement-type { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .type-general { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .type-event { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .type-alert { background: rgba(30, 41, 59, 0.18); color: var(--text-secondary); }
        .type-maintenance { background: rgba(30, 41, 59, 0.18); color: var(--text-secondary); }

        .announcement-title { font-size: 1.25rem; font-weight: 600; color: var(--text); margin-bottom: 8px; }
        .announcement-meta { display: flex; gap: 15px; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 12px; }
        .announcement-content { color: var(--text); line-height: 1.6; margin-bottom: 12px; }
        .announcement-footer { display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid var(--border); }
        .posted-by { font-size: 0.85rem; color: var(--text-secondary); }

        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; background: var(--panel); border-radius: 12px; border: 1px solid var(--border); }
        .empty-state img { width: 120px; opacity: 0.5; margin-bottom: 20px; }
        .empty-state h3 { color: var(--text); margin-bottom: 10px; }
        .empty-state p { color: var(--text-secondary); }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: var(--panel); padding: 30px; border-radius: 12px; border: 1px solid var(--border); max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px; }
        .modal-title { font-size: 1.5rem; font-weight: 600; color: var(--text); }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary); }
        .modal-body { color: var(--text); line-height: 1.8; }

        /* Sidebar notification item styling */
        .notification-item { display: flex; align-items: center; gap: 10px; padding: 12px 16px; border-radius: 8px; cursor: pointer; transition: background 0.3s, color 0.3s; color: var(--text); }
        .notification-item:hover { background: rgba(16, 185, 129, 0.1); }
        .notification-item.active { background: var(--brand); color: #fff; font-weight: 600; }
        .notification-item.active img { filter: brightness(0) invert(1); }
      -->
    </head>
    <body>
      <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
          <a href="/" aria-label="Home">
            <div class="logo">
              <img src="{% static 'logo.png' %}" alt="Labang Logo" />
              <span>LabangOnline</span>
            </div>
          </a>

          <div
            class="notification-item {% if request.resolver_match.url_name == 'announcements' %}active{% endif %}"
            onclick="window.location.href='{% url 'accounts:announcements' %}'"
          >
            <div class="notification-icon-wrapper">
              <img
                src="{% static 'icons/notification.png' %}"
                alt="Notification"
              />
              <span class="notification-badge">{{ unread_count|default:0 }}</span>
            </div>
            <span>Announcements</span>
          </div>

          <ul class="menu">
            <li
              class="menu-item"
              onclick="window.location.href='{% url 'accounts:personal_info' %}'"
            >
              <img src="{% static 'icons/user-info.png' %}" alt="" />
              <span>Personal Info</span>
            </li>
            <li
              class="menu-item"
              onclick="window.location.href='{% url 'accounts:document_request' %}'"
            >
              <img src="{% static 'icons/request-records.png' %}" alt="" />
              <span>Document Request</span>
            </li>

            <li
              class="menu-item"
              onclick="window.location.href='{% url 'accounts:file_report' %}'"
            >
              <img src="{% static 'icons/file-report.png' %}" alt="" />
              <span>File Report</span>
            </li>
          </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
          <!-- Top bar -->
          <header class="topbar">
            <span></span>
            <button id="mode-toggle" class="btn">Toggle</button>
            <div class="user-profile">
              {% if user.profile_photo_url %}
              <img src="{{ user.profile_photo_url }}" alt="User Profile" />
              {% else %}
              <img
                src="{% static 'icons/default_user.png' %}"
                alt="User Profile"
              />
              {% endif %}
              <span>{{ user.full_name }}</span>
              <form method="get" action="{% url 'accounts:logout_confirm' %}">
                <button type="submit" class="btn-logout">LOGOUT</button>
              </form>
            </div>
          </header>

          <div class="announcements-container">
            <div class="page-header">
              <h1>üì¢ Barangay Announcements</h1>
              <p>
                Stay updated with the latest news and events from Barangay
                Labangon
              </p>
            </div>

            <!-- Filter Section -->
            <div class="filter-section">
              <div class="filter-buttons">
                <button class="filter-btn active" data-type="all">All</button>
                <button class="filter-btn" data-type="general">General</button>
                <button class="filter-btn" data-type="event">Events</button>
                <button class="filter-btn" data-type="alert">Alerts</button>
                <button class="filter-btn" data-type="maintenance">Maintenance</button>
              </div>
            </div>

            <!-- Announcements Grid -->
            {% if announcements %}
            <div class="announcements-grid">
              {% for announcement in announcements %}
              <div
                class="announcement-card {{ announcement.announcement_type }}"
                onclick="openModal({{ announcement.id }})"
              >
                <div class="announcement-header">
                  <span
                    class="announcement-type type-{{ announcement.announcement_type }}"
                  >
                    {{ announcement.get_announcement_type_display }}
                  </span>
                </div>
                <h3 class="announcement-title">{{ announcement.title }}</h3>
                <div class="announcement-meta">
                  <span>üìÖ Date Posted: {{ announcement.created_at|timezone:"Asia/Manila"|date:"F d, Y" }}</span>
                  <span>üïê Time: {{ announcement.created_at|timezone:"Asia/Manila"|date:"h:i A" }}</span>
                </div>                
                <p class="announcement-content">
                  {{ announcement.content|truncatewords:30 }}
                </p>
                <div class="announcement-footer">
                  <span class="posted-by">
                    Posted by: 
                    {% if announcement.posted_by %}{{ announcement.posted_by.full_name }}{% else %}Administrator{% endif %}
                  </span>
                  <span style="color: #10b981; font-size: 0.9rem"
                    >Read more ‚Üí</span
                  >
                </div>
              </div>

              <!-- Hidden modal content for each announcement -->
              <div id="modal-{{ announcement.id }}" class="modal">
                <div class="modal-content">
                  <div class="modal-header">
                    <div>
                      <span
                        class="announcement-type type-{{ announcement.announcement_type }}"
                      >
                        {{ announcement.get_announcement_type_display }}
                      </span>
                      <h2 class="modal-title">{{ announcement.title }}</h2>
                      <div class="announcement-meta">
                        <span>üìÖ Date Posted: {{ announcement.created_at|date:"F d, Y" }}</span>
                        <span>üïê Time: {{ announcement.created_at|date:"h:i A" }}</span>
                      </div>
                    </div>
                    <button
                      class="modal-close"
                      onclick="closeModal({{ announcement.id }})"
                    >
                      &times;
                    </button>
                  </div>
                  <div class="modal-body">
                    <p>{{ announcement.content|linebreaks }}</p>
                    <div
                      style="
                        margin-top: 20px;
                        padding-top: 20px;
                        border-top: 1px solid var(--border);
                      "
                    >
                      <small style="color: var(--text-secondary)">
                        Posted by: 
                    {% if announcement.posted_by %}{{ announcement.posted_by.full_name }}{% else %}Administrator{% endif %}
                      </small>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
              <img
                src="{% static 'icons/notification.png' %}"
                alt="No Announcements"
              />
              <h3>No Announcements Available</h3>
              <p>
                There are currently no announcements from the barangay. Check back
                later for updates!
              </p>
            </div>
            {% endif %}
          </div>
        </main>
      </div>

      <script src="{% static 'js/dashboard.js' %}"></script>
    <script>
        function openModal(id) {
          const modal = document.getElementById(`modal-${id}`);
          if (modal) {
            modal.classList.add("active");
          }
        }

        function closeModal(id) {
          const modal = document.getElementById(`modal-${id}`);
          if (modal) {
            modal.classList.remove("active");
          }
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
          if (event.target.classList.contains("modal")) {
            event.target.classList.remove("active");
          }
        };

        (function() {
          const buttons = document.querySelectorAll('.filter-btn');
          const cards = document.querySelectorAll('.announcement-card');
          function applyFilter(type) {
            buttons.forEach(b => b.classList.remove('active'));
            const activeBtn = Array.from(buttons).find(b => b.dataset.type === type) || document.querySelector('.filter-btn[data-type="all"]');
            if (activeBtn) activeBtn.classList.add('active');
            cards.forEach(card => {
              if (type === 'all') {
                card.style.display = '';
              } else {
                const matches = card.classList.contains(type);
                card.style.display = matches ? '' : 'none';
              }
            });
          }
          buttons.forEach(btn => {
            btn.addEventListener('click', () => applyFilter(btn.dataset.type));
          });
          applyFilter('all');
        })();
      </script>
  {% include 'accounts/chatbot.html' %}
  </body>
  </html>
