{% extends 'base.html' %} {% load static %} {% block title %}Verify Code |
Labang Online{% endblock %} {% block content %}
<main class="site-main">
  <div class="brgy-panel panel">
    <div class="header"><h1>Verify Code</h1></div>
    <div class="body">
      <form method="post" class="grid">
        {% csrf_token %}

        <img
          src="{% static 'images/forgot_password_illustration.png' %}"
          alt="Verify Code Graphic"
          style="
            display: block;
            margin: 28px auto 0 auto;
            width: 220px;
            opacity: 0.9;
          "
        />

        <p class="hint-text">
          We've sent a 6-digit verification code to <strong>{{ user.email }}</strong>.<br />
          This code expires in <strong>5 minutes</strong>. Please enter the code below to continue.
        </p>

        {% if messages %}
        <div class="messages">
          {% for message in messages %}
          <div class="msg {% if message.tags %}{{ message.tags }}{% endif %}">
            {{ message }}
          </div>
          {% endfor %}
        </div>
        {% endif %}

        <div>
          <label for="code">Verification Code</label>
          <input
            type="text"
            id="code"
            name="code"
            required
            maxlength="6"
            pattern="[0-9]{6}"
            placeholder="123456"
            style="text-align: center; font-size: 1.2em; letter-spacing: 0.2em;"
            autocomplete="off"
          />
        </div>

        <div class="actions center-actions">
          <button type="submit" class="btn btn-primary">Verify Code</button>
          <a href="{% url 'accounts:forgot_password' %}" class="btn btn-secondary">Back to Email</a>
          <a href="{% url 'accounts:resend_code' user.id %}" class="btn btn-secondary">Resend Code</a>
        </div>
      </form>
    </div>
  </div>
</main>

<script>
// Auto-format the input to only allow 6 digits
document.getElementById('code').addEventListener('input', function(e) {
    // Remove any non-digit characters
    let value = e.target.value.replace(/\D/g, '');
    
    // Limit to 6 digits
    if (value.length > 6) {
        value = value.substring(0, 6);
    }
    
    e.target.value = value;
    
    // Auto-submit when 6 digits are entered
    if (value.length === 6) {
        setTimeout(() => {
            e.target.form.submit();
        }, 500);
    }
});

// Optional: display a 5-minute countdown
(function() {
  const container = document.querySelector('.hint-text');
  const end = Date.now() + 5 * 60 * 1000;
  function fmt(ms){
    const s = Math.max(0, Math.floor(ms/1000));
    const m = Math.floor(s/60);
    const r = s % 60;
    return `${m}:${r.toString().padStart(2,'0')}`;
  }
  function tick(){
    const left = end - Date.now();
    if (container) container.innerHTML = `We've sent a 6-digit verification code to <strong>{{ user.email }}</strong>.<br />This code expires in <strong>5 minutes</strong> (time left: <strong>${fmt(left)}</strong>).`;
    if (left <= 0) return; else setTimeout(tick, 1000);
  }
  tick();
})();

// Focus on the input when page loads
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('code').focus();
});
</script>
{% endblock %}
