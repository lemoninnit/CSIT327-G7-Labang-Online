{% extends 'base.html' %} {% load static %} {% block title %}Verify Code |
Labang Online{% endblock %} {% block content %}
<main class="site-main">
  <div class="brgy-panel panel">
    <div class="header"><h1>Verify Code</h1></div>
    <div class="body">
      <form method="post" class="grid">
        {% csrf_token %}

        <img
          src="{% static 'images/forgot_password_illustration.png' %}"
          alt="Verify Code Graphic"
          style="
            display: block;
            margin: 28px auto 0 auto;
            width: 220px;
            opacity: 0.9;
          "
        />

        {% if verification_code %}
        <div style="padding: 20px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border: 2px solid rgba(16, 185, 129, 0.3); border-radius: 16px; text-align: center; margin: 20px 0;">
          <p style="margin: 0 0 12px 0; color: var(--muted); font-size: 14px; font-weight: 500;">Your Verification Code:</p>
          <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 12px; flex-wrap: wrap;">
            <code id="verification-code-display" style="font-size: 32px; font-weight: 700; color: #10b981; letter-spacing: 8px; font-family: 'Courier New', monospace; padding: 12px 24px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border: 2px dashed rgba(16, 185, 129, 0.3);">{{ verification_code }}</code>
            <button type="button" onclick="copyVerificationCode()" style="padding: 12px 16px; background: #10b981; color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
              </svg>
              Copy
            </button>
          </div>
          <p style="margin: 0; color: var(--muted); font-size: 12px;">You can copy and paste this code into the field below</p>
        </div>
        {% endif %}

        {% if messages %}
        <div class="messages">
          {% for message in messages %}
          <div class="msg {% if message.tags %}{{ message.tags }}{% endif %}">
            {{ message }}
          </div>
          {% endfor %}
        </div>
        {% endif %}

        <div>
          <label for="code">Verification Code</label>
          <input
            type="text"
            id="code"
            name="code"
            required
            maxlength="6"
            pattern="[0-9]{6}"
            placeholder="123456"
            style="text-align: center; font-size: 1.2em; letter-spacing: 0.2em;"
            autocomplete="off"
          />
        </div>

        <div class="actions center-actions">
          <button type="submit" class="btn btn-primary">Verify Code</button>
          <a href="{% url 'accounts:forgot_password' %}" class="btn btn-secondary">Back to Email</a>
          <a href="{% url 'accounts:resend_code' user.id %}" class="btn btn-secondary">Resend Code</a>
        </div>
      </form>
    </div>
  </div>
</main>

<script>
// Auto-format the input to only allow 6 digits
document.getElementById('code').addEventListener('input', function(e) {
    // Remove any non-digit characters
    let value = e.target.value.replace(/\D/g, '');
    
    // Limit to 6 digits
    if (value.length > 6) {
        value = value.substring(0, 6);
    }
    
    e.target.value = value;
    
    // Auto-submit when 6 digits are entered
    if (value.length === 6) {
        setTimeout(() => {
            e.target.form.submit();
        }, 500);
    }
});


// Focus on the input when page loads
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('code').focus();
});

// Copy verification code function
function copyVerificationCode() {
    const code = document.getElementById('verification-code-display').textContent.trim();
    navigator.clipboard.writeText(code).then(function() {
        // Show feedback
        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 6px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Copied!';
        btn.style.background = '#059669';
        setTimeout(function() {
            btn.innerHTML = originalText;
            btn.style.background = '#10b981';
        }, 2000);
    }).catch(function(err) {
        console.error('Failed to copy code:', err);
        alert('Failed to copy code. Please copy it manually.');
    });
}
</script>
{% endblock %}
